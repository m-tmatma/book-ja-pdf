dist: bionic
language: generic
sudo: required
env:
  global:
    - IMAGE_NAME=yyupw/trpl-2nd-pdf
    - REGISTRY_USER=yyupw
    - DOCKER_COMPOSE_VERSION=1.24.0
    - secure: gAp4f13/5ZPGOYZTyd6VSC+QVU1TG5tDb0YMoIgSPQ8TNSOi3C4BQ9hdK05BRjo1fkeJwBBtHTh8yMMQ/Y75YnfscpzTtiTEXcxoEbNeGFeZysA0adcL9MbXWZ+QyH/DKFaL1w5aevXxSVV0/3bfh2grFXh73tTgl1/WhQ8PLBdNPLXyMX7pz9p27NL5l66LYjbIvdjSq+PFkEac9scoHVottA7dKcJSlRDMBSlqt2B4xEDbtP+8tp0D9tVWbzWJ1APZ1L6m+GZPzVmJDuFKJc3mYGze6eUI3NNoQUXhs1gZ0WHAivl/PQezWLQD/Z90hP3C36/eMS4mwOhQ0Km8vE6XH/EREvX+X6I4NxS3mP7OPwp1zyEPU+YZlEr9ydsjxREO/uib4Zog390z0JCRwB/6KYDQY8n2LQ4dxwV+fn195XtZAzuRRv+OFiwN5npvfbsyr837OFQhlW9GevVCLv/TzWct/2WPD9X1mzEE35mKgpWuzikkNdM9EEQGGo6VYEuk4g0ZVs4zoSOBaSgf013rSdjtDE9JOIax0pKRcK0lGx2/CJyyavHx1GJRshBhzg+I4jSejZKv2gpChNW1q/ovGrBzoJJTOE9IF/9fHXIjAYH0FtWx79Oh/XL4VAOq7ihmJCcxZswR4QAFPcCsxX/1rWlDxByWiA6CUTn0YNs=
    - secure: 2vPnRh5Ko8HXR0iL0KVPOQUYlWoZCfk4uHXDjOt38KHz4QB9gpIr+vXUq65YVbRXV4+X6tfwHSdYWP/mA0dQUvRkfzTtko6pjpdwqO7nm6NbS3iH1DEgxhO6pN0eO9WMynAF9bzGzBeHuTbCTH+MqFMgUH/ROtK0o91ofWRiqkIhDvUZ1YxCElEFLpZ0n6Ml49+zshGvDng3g9+dyW3BWt9fY3gdHdIypEH3xuxP4KjnUTrmmv7s+QiFL1IWd6+ucVTCxKaTArE4HHsnbTQxZ8moNW/I3BCrwPgJbbSxf/vGF2RFToihHph1m8oFHzv7hPL/FDgmlNkgJRMRFFLOKFCNUXBI5VP/OgqICmdTB/vV75iedlOxtGek2mczSKvNOofm1220AGOLKS4L4srI6R08+TCbyqxMglqfkjMyARb2WpAJaOnnF+hEPAhOTC534zP6Ok+f3sw39kvpvYNOPXtwLpupxQ546QPH7YIxyE3hZayvK3atXrfXfRb9m/0tNTkxYTEelNkKQkh7VHfzAsA497ytxpmZixoS3vnro0uxJxAf8e2g93Zsh6B4VDur2nlmd2UunvR7Um6gwZCeAYSHUb/+Wmp612/A6iDEobJBVPS8h0oSxX2y0Z+l38W80Q/9pXPymzbOaVEv4zeMVjJUaQFHJwBc0xyvlqVKsU0=
services:
  - docker
branches:
  only:
    - master
before_install:
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
install:
  - docker-compose pull
  - docker-compose build
script:
  - docker-compose up --exit-code-from trpl-pdf-compile
after_success:
  - ./travis/deploy_image.sh
  - ./travis/deploy_pdf.sh
after_failure:
  - cat book.log
